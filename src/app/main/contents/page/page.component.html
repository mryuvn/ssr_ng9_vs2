<div *ngIf="pageConfig" id="page" 
    class="page 
        {{params.moduleRoute}}
        {{routerLoaded ? 'router-loaded' : ''}}
        {{pageConfig.pageFullscreen ? 'fullscreen' : ''}}">

    <ng-container *ngIf="!pageConfig.slideConfig">
        <div class="page-banner" 
            [style.height]="pageConfig.headerHeight ? pageConfig.headerHeight : '400px'">
        
            <div class="page-cover">
                <img [src]="pageCover" alt="" width="100%">
            </div>
            
            <div class="content">
                <div class="container">
                    <div class="data">
                        <h1 class="site-title">{{siteTitle}}</h1>
                        <span *ngIf="siteCaption" class="caption" [innerHtml]="siteCaption | safeHtml"></span>
                    </div>
                </div>
            </div>
        </div>
    </ng-container>

    <div *ngIf="pageConfig.slideConfig" class="header" 
        [style.max-height]="pageConfig.headerHeight ? pageConfig.headerHeight : 'auto'">
        <app-main-slider 
            [pageID]="data.id" 
            [coverUrl]="pageCover" 
            [title]="siteTitle" 
            [caption]="siteCaption" 
            [slideConfig]="pageConfig.slideConfig"></app-main-slider>
    </div>

    <div class="page-content {{data.id ? pageConfig.sidebar ? 'sidebar-'+pageConfig.sidebar : '' : 'sidebar-right'}}">
        <div class="container">
            <div class="navigation">
                <div class="map">
                    <a routerLink="/"><i class="fas fa-home"></i></a> 
                    <span class="raquo">&raquo;</span> 
                    <a [routerLink]="'/'+generalData.route">{{moduleData.nameValue}}</a>
                    <!-- <ng-container *ngIf="data.id!==generalData.id">
                        <span class="raquo">&raquo;</span> 
                        <a [routerLink]="'/'+data.route">{{data.name}}</a>
                    </ng-container> -->
                </div>

                <div class="menu">
                    <app-menu></app-menu>
                </div>
            </div>
        </div>

        <ng-container *ngIf="!pageConfig.moduleTemplate">
            <div class="container">
                <div [class.row]="pageConfig.sidebar || !data.id">
                    <div [class.col-xl-8]="pageConfig.sidebar || !data.id">
                        <div *ngIf="data.avatar" class="page-avatar {{pageConfig.avatarPosition}}">
                            <div class="picture">
                                <app-avatar class="{{data.avatarType}}"
                                    (click)="openImageViewer(0)" 
                                    type="avatar" 
                                    [filename]="data.avatar" 
                                    [src]="data.avatarUrl" 
                                    [alt]="data.name" 
                                    width="100%" 
                                    shape="square" 
                                    [noImage]="'no-avatar.jpg'" 
                                    [table]="tables.posts" 
                                    [updateId]="data.id" 
                                    [uploadPath]="uploadPath"></app-avatar>
                            </div>
                        </div>

                        <ng-container *ngIf="pageTitle">
                            <h2 class="page-title">{{pageTitle}}</h2>
                            <span class="headingline"></span>
                        </ng-container>
        
                        <em *ngIf="data.mess" class="text-error" [innerHtml]="data.mess | safeHtml"></em>
                        
                        <div class="text" [class.hidden]="!data.id">
                            <p *ngIf="data.caption && data.caption!==generalData.caption" 
                                class="caption" [innerHtml]="data.caption | safeHtml"></p>
        
                            <ng-container *ngFor="let item of contents; index as i;">
                                <h3 *ngIf="item.title!==pageTitle">{{item.title}}</h3>
                                <p *ngIf="item.caption" [innerHtml]="item.caption | safeHtml"></p>
                                <div *ngIf="item.content" [innerHtml]="item.content | safeHtml"></div>
                            </ng-container>

                            <div *ngIf="data.continueBtn" class="continue-button {{data.continueBtn.position}}">
                                <app-continue-btn 
                                    [data]="data.continueBtn" 
                                    [color]="data.continueBtn.color" 
                                    [size]="data.continueBtn.size" 
                                    [icon]="data.continueBtn.icon"></app-continue-btn>            
                            </div>
                        </div>

                        <ng-container *ngIf="pageConfig.childCatStyles && childCats.length>0">
                            <app-cats-list *ngIf="pageConfig.childCatStyles.position==='affterContent'"
                                [dataSource]="childCats" 
                                [lang]="lang" 
                                [config]="pageConfig.childCatStyles" 
                                [title]="moduleData.contentData.childCatsTitle" 
                                [db_table]="tables.posts" 
                                [uploadPath]="uploadPath" 
                                [dateFormat]="dateFormat" 
                                [moduleID]="moduleData.id"></app-cats-list>
                        </ng-container>
        
                        <div *ngIf="contents.length>0" class="page-bottom">
                            <span class="pull-left">
                                <iframe src="https://www.facebook.com/plugins/like.php?href=https%3A%2F%2Fdevelopers.facebook.com%2Fdocs%2Fplugins%2F&width=115&layout=button&action=like&size=small&share=true&height=65&appId=1121788874905560" width="115" height="65" style="border:none;overflow:hidden" scrolling="no" frameborder="0" allowfullscreen="true" allow="autoplay; clipboard-write; encrypted-media; picture-in-picture; web-share"></iframe>
                            </span>
    
                            <span class="pull-right">
                                <span class="time" *ngIf="siteValues">
                                    {{langData.updated}}: 
                                    <ng-container *ngIf="data.updatedTime"> {{data.updatedTime | date:dateFormat + ' HH:mm:ss'}}</ng-container>
                                    <ng-container *ngIf="!data.updatedTime"> {{data.createdTime | date:dateFormat + ' HH:mm:ss'}}</ng-container>
                                </span>
                            </span>
                        </div>
        
                        <ng-container *ngIf="pageConfig.postStyles && articles.length>0">
                            <app-posts-list *ngIf="pageConfig.postStyles.position==='affterContent'" 
                                [class.hidden]="articles.length===0 || data.id!==generalData.id && articles.length===1"
                                [dataSource]="articles" 
                                [config]="pageConfig.postStyles" 
                                [contentData]="moduleData.contentData" 
                                [pageData]="data" 
                                [db_table]="tables.posts" 
                                [uploadPath]="uploadPath" 
                                [dateFormat]="dateFormat" 
                                [langData]="langData"></app-posts-list>
                        </ng-container>

                        <ng-container *ngIf="pageConfig.sameCatStyles && sameCats.length>0">
                            <app-cats-list *ngIf="pageConfig.sameCatStyles.position==='affterContent'"
                                [dataSource]="sameCats" 
                                [lang]="lang" 
                                [config]="pageConfig.sameCatStyles" 
                                [title]="moduleData.contentData.sameCatsTitle === true ? parentCat.nameValue : moduleData.contentData.sameCatsTitle" 
                                [db_table]="tables.posts" 
                                [uploadPath]="uploadPath" 
                                [dateFormat]="dateFormat" 
                                [moduleID]="moduleData.id"></app-cats-list>
                        </ng-container>

                        <ng-container *ngIf="pageConfig.contentQuote && isBrowser">
                            <app-content-quote></app-content-quote>
                        </ng-container>
                    </div>

                    <div [class.col-xl-4]="pageConfig.sidebar || !data.id" 
                        [class.sidebar]="pageConfig.sidebar || !data.id">
                        <ng-container *ngIf="pageConfig.postStyles">
                            <app-posts-list *ngIf="pageConfig.postStyles.position==='onSidebar'" 
                                [class.hidden]="articles.length===0 || data.id!==generalData.id && articles.length===1"
                                [dataSource]="articles" 
                                [config]="pageConfig.postStyles" 
                                [contentData]="moduleData.contentData" 
                                [pageData]="data" 
                                [db_table]="tables.posts" 
                                [uploadPath]="uploadPath" 
                                [dateFormat]="dateFormat" 
                                [langData]="langData"></app-posts-list>
                        </ng-container>

                        <ng-container *ngIf="pageConfig.childCatStyles && childCats.length>0">
                            <app-cats-list *ngIf="pageConfig.childCatStyles.position==='onSidebar'"
                                [dataSource]="childCats" 
                                [lang]="lang" 
                                [config]="pageConfig.childCatStyles" 
                                [title]="moduleData.contentData.childCatsTitle" 
                                [db_table]="tables.posts" 
                                [uploadPath]="uploadPath" 
                                [dateFormat]="dateFormat" 
                                [moduleID]="moduleData.id"></app-cats-list>
                        </ng-container>

                        <ng-container *ngIf="pageConfig.sameCatStyles && sameCats.length>0">
                            <app-cats-list *ngIf="pageConfig.sameCatStyles.position==='onSidebar'"
                                [dataSource]="sameCats" 
                                [lang]="lang" 
                                [config]="pageConfig.sameCatStyles" 
                                [title]="moduleData.contentData.sameCatsTitle === true ? parentCat.nameValue : moduleData.contentData.sameCatsTitle" 
                                [db_table]="tables.posts" 
                                [uploadPath]="uploadPath" 
                                [dateFormat]="dateFormat" 
                                [moduleID]="moduleData.id"></app-cats-list>
                        </ng-container>

                        <div class="sticky-top">
                            <div *ngIf="siteValues && isBrowser" class="contact-form">
                                <app-contact-form [siteValues]="siteValues"></app-contact-form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </ng-container>

        <ng-container *ngIf="pageConfig.moduleTemplate==='cource'">
            <app-cource 
                [lang]="lang" 
                [data]="data" 
                [pageTitle]="pageTitle" 
                [table]="tables.posts" 
                [uploadPath]="uploadPath" 
                [contents]="contents" 
                [articles]="articles" 
                [moduleData]="moduleData" 
                [sameCatsConfig]="pageConfig.sameCatStyles"
                [sameCats]="sameCats" 
                [expandMenuMod]="moduleData.config.expandMenuMod" 
                [isBrowser]="isBrowser"></app-cource>
        </ng-container>
    </div>
</div>